# Changelog

## [1.3.2] - 2025-08-20
- **機能改善**
  - **パフォーマンス**: アシスタントの応答ストリーミング中の処理を最適化し、CPU負荷を大幅に軽減した。(1.3.0で目指したパフォーマンス改善の最小パッチ) 。

## [1.3.1] - 2025-08-20
- **修正**: v1.3.0で発生した、設定パネルのトグルが即時反映されないバグを修正。根本原因はObserverManagerのパフォーマンス改善を目的としたリファクタリングにあったため、この部分のロジックをv1.2.1の実装に差し戻した。
- **機能改善**: v1.3.0で導入した以下の改善は維持されています。
  - **パフォーマンス**: 立ち絵(`StandingImageManager`)の描画を最適化し、負荷の高いレイアウト計算を軽微なUI更新から分離しました。レイアウト計算は、実際にレイアウトが変更されるイベント発生時のみに限定されます。
  - **パフォーマンス**: メッセージキャッシュ(`MessageCacheManager`)から、ブラウザの強制的なリフローを引き起こす高負荷なソート処理を削除し、パフォーマンスのボトルネックを解消しました。

## [1.3.0] - 2025-08-18
- **機能改善**
  - **パフォーマンス**: DOM監視ロジック(`ObserverManager`)を根本的にリファクタリングし、AIの応答ストリーミング中に発生していた高いCPU負荷を解消しました。新しいシステムでは、高頻度のポーリングに代わって要素ごとのオブザーバーを使用するため、アバターの表示問題もより効率的に解決されます。
  - **パフォーマンス**: 立ち絵(`StandingImageManager`)の描画を最適化し、負荷の高いレイアウト計算を軽微なUI更新から分離しました。レイアウト計算は、実際にレイアウトが変更されるイベント発生時のみに限定されます。
  - **パフォーマンス**: メッセージキャッシュ(`MessageCacheManager`)から、ブラウザの強制的なリフローを引き起こす高負荷なソート処理を削除し、パフォーマンスのボトルネックを解消しました。
- **変更**
  - **アーキテクチャ**: 全てのメッセージバブルUI機能（折りたたみ、先頭へスクロール、次/前へ移動）の基本ロジックをリファクタリングしました。従来のターン基準(`processTurn`)の処理を廃止し、メッセージ中心(`processElement`)の処理に一貫して統一したことで、コードの明確性と保守性が向上しました。

## [1.2.1] - 2025-08-15
- **機能追加**: 機能利用時に、追加UIが干渉しないように動的な位置調整機能を追加した。
  - **立ち絵:** Canvas利用時は非表示にした。
  - **設定ボタン:** Canvasに干渉しないように自動的に位置が移動する。

## [1.2.0] - 2025-08-05
- **機能追加**: 複数タブで同時利用している際に、設定を自動で同期するようにした。
- **改善**: テーマ設定画面のプレビュー機能を改善した。未設定の項目にはユーザー指定のデフォルトテーマ（`defaultSet`）の値が反映されるようになり、実際の適用結果と一致する直感的な表示（WYSIWYG）となった。
- **改善**: テーマ名変更のUIを改善（インラインで変更可能にした）。
- 各種アイコンで絵文字の使用をやめてSVGを使用するようにした。
- 初期化ロジックを改善し安定性を向上させた。
- CSS周りの不具合調整（想定した設定が適用されていなかった）。
- **内部コードの改善**: その他、内部処理の改善。

## [1.1.1] - 2025-07-27
- **安定性の向上:** Firefox環境において、ページの初回読み込み時にUI（設定ボタンなど）が正常に表示・動作しないことがある不安定な問題を修正。
  - **原因:** サイトのUI描画処理との競合（レースコンディション）が原因と考えられる。
  - **対策:** サイトのUIが完全に操作可能になったことをより確実に検知してからスクリプトを起動するよう、初期化ロジックを見直した。

## [1.1.0] - 2025-07-26
- テーマ設定画面の項目順を変更。`background color` -> `text color` の順にした（全ブロックで背景色が先頭になるようにした）。	
- メッセージの開閉トグルで、確実に現在のメッセージ（ハイライトされているメッセージ）を表示するように調整。
- **メッセージキャッシュ機能の導入と最適化**: メッセージ要素の取得と管理を効率化するために、メッセージキャッシュ機能を導入した。これにより、スクリプトのパフォーマンスが向上し、特定の機能（折りたたみ、スクロール、順次ナビゲーションなど）がよりスムーズに動作する。
- **ナビゲーション機能の改善**: メッセージ間を移動する際のボタンの計算ロジックを修正し、より正確なメッセージへのジャンプを可能にした。
- **コードの共通化と保守性の向上**: プラットフォーム固有のロジックを`PlatformAdapter`クラスに集約した。
- `@connect`の定義を`p65536.github.io`から`raw.githubusercontent.com`に変更（`project_theme_sample.json`内のサンプル画像のURLも変更）
- **内部コードの改善**: その他、コードの可読性と堅牢性を高めるための修正。

## [1.0.0] - 2025-07-21
- 一般公開